<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Twin-Gladius ‚Äî Mobile Shoot 'em up</title>
<style>
  :root{--bg:#041022;--panel:rgba(0,0,0,0.45);--accent:#ffd86b}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;background:var(--bg);color:#fff}
  #wrap{max-width:1100px;margin:0 auto;padding:10px;display:flex;flex-direction:column;gap:8px}
  header{display:flex;justify-content:space-between;align-items:center}
  h1{font-size:18px;margin:0}
  .controlsRow{display:flex;gap:8px;align-items:center}
  .btn{background:var(--panel);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  #gameWrap{width:100%;aspect-ratio:9/16;max-height:88vh;background:linear-gradient(180deg,#041022 0%,#00111a 100%);border-radius:12px;position:relative;overflow:hidden}
  canvas{width:100%;height:100%;display:block}
  #hud{position:absolute;left:8px;top:8px;display:flex;gap:10px;align-items:center;z-index:20}
  #hud .panel{background:var(--panel);padding:6px 8px;border-radius:8px;font-size:13px}
  #touchControls{position:absolute;right:8px;bottom:8px;display:flex;gap:8px;align-items:center;z-index:30}
  .touchBtn{width:64px;height:64px;border-radius:14px;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;font-weight:700;user-select:none}
  .stick{position:absolute;left:12px;bottom:12px;width:160px;height:160px;border-radius:50%;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;touch-action:none}
  .stick .knob{width:56px;height:56px;border-radius:50%;background:rgba(255,255,255,0.06);display:block}
  @media(min-width:900px){ #gameWrap{aspect-ratio:16/9} .stick{width:200px;height:200px} }
  #overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:40}
  #menu{background:rgba(0,0,0,0.7);padding:18px;border-radius:12px;text-align:center;width:min(420px,92%)}
  #menu h2{margin:0 0 8px}
  #powerMeter{width:240px;height:18px;background:rgba(255,255,255,0.06);border-radius:9px;overflow:hidden}
  #powerFill{height:100%;width:0;background:linear-gradient(90deg,#7ef9ff,#ffd86b)}
  .small{font-size:13px;color:#ddd}
</style>
</head>
<body>
<div id="wrap">
  <header>
    <h1>Twin-Gladius ‚Äî TwinBee x Gradius inspired</h1>
    <div class="controlsRow">
      <div class="btn" id="startBtn">Start</div>
      <div class="btn" id="pauseBtn">Pause</div>
      <div class="btn" id="soundBtn">üîä</div>
    </div>
  </header>

  <div id="gameWrap">
    <canvas id="c"></canvas>

    <div id="hud">
      <div class="panel">Score: <span id="score">0</span></div>
      <div class="panel">Lives: <span id="lives">3</span></div>
      <div class="panel" style="display:flex;align-items:center;gap:8px">Power:
        <div id="powerMeter"><div id="powerFill"></div></div>
      </div>
    </div>

    <div id="overlay">
      <div id="menu">
        <h2>Twin-Gladius</h2>
        <div class="small">‰ª≤ÈñìÊúÄÂ§ß5‰Ωì & „Ç∑„Éº„É´„Éâ„Éô„É´ËøΩÂä†„Éê„Éº„Ç∏„Éß„É≥</div>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
          <div class="btn" id="play">Play</div>
          <div class="btn" id="how">How</div>
        </div>
      </div>
    </div>

    <div class="stick" id="stick" aria-hidden="true"><div class="knob" id="knob"></div></div>
    <div id="touchControls">
      <div class="touchBtn" id="shootBtn">SHOOT</div>
      <div class="touchBtn" id="powerBtn">POWER</div>
    </div>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  function resize() {
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * devicePixelRatio);
    canvas.height = Math.floor(rect.height * devicePixelRatio);
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  window.addEventListener('resize', resize);
  resize();

  const startBtn=document.getElementById('startBtn');
  const pauseBtn=document.getElementById('pauseBtn');
  const soundBtn=document.getElementById('soundBtn');
  const overlay=document.getElementById('overlay');
  const play=document.getElementById('play');
  const scoreEl=document.getElementById('score');
  const livesEl=document.getElementById('lives');
  const powerFill=document.getElementById('powerFill');

  let W=canvas.clientWidth,H=canvas.clientHeight;
  window.addEventListener('resize',()=>{W=canvas.clientWidth;H=canvas.clientHeight;});

  let running=false,paused=false,last=0;
  const player={x:W/2,y:H-100,w:36,h:20,spd:180,vx:0,vy:0,shotCooldown:0,optionSlots:[],shield:false};

  let bullets=[],enemyBullets=[],enemies=[],pickups=[],particles=[];
  let score=0,lives=3;
  const POWER_MAX=8; let power=0;
  function updatePowerUI(){ powerFill.style.width=(power/POWER_MAX*100)+'%'; }

  function addPower(n=1){ power=Math.min(POWER_MAX,power+n); updatePowerUI(); }
  function usePower(){ if(power>=1){ const choice=power; power=0; updatePowerUI(); activatePower(choice); } }

  function addOption(){ if(player.optionSlots.length<5){ player.optionSlots.push({x:player.x,y:player.y}); } }

  function activatePower(level){ if(level<=1){ player.spd*=1.4; setTimeout(()=>{player.spd/=1.4;},4000); }
    else if(level<=3){ const orig=player.shotCooldown; player.shotCooldown=Math.max(0.08,orig*0.6); setTimeout(()=>{player.shotCooldown=orig;},5000); }
    else if(level<=5){ addOption(); }
    else{ for(let e of enemies){ e.hp-=3; } }
  }

  function spawnBell(x,y){ pickups.push({type:'bell',x,y,w:18,h:18,vy:45,bellType:Math.floor(Math.random()*5)}); }

  function rectsOverlap(a,b){ return a.x<b.x+b.w && a.x+(a.w||10)>b.x && a.y<b.y+b.h && a.y+(a.h||10)>b.y; }

  function loseLife(){ if(player.shield){ player.shield=false; return; }
    lives--; if(lives<=0) endGame(); else { player.x=W/2;player.y=H-120; } }

  function endGame(){ running=false; overlay.style.display='flex'; overlay.querySelector('h2').innerText='Game Over'; }

  function explode(x,y,count){ for(let i=0;i<count;i++){ particles.push({x:x,y:y,vx:(Math.random()-0.5)*200,vy:(Math.random()-0.5)*200,life:0.6+Math.random()*0.6}); } }

  function update(dt){
    if(!running||paused) return;
    player.x+=player.vx*dt; player.y+=player.vy*dt;
    player.x=Math.max(6,Math.min(W-player.w-6,player.x));
    player.y=Math.max(6,Math.min(H-player.h-60,player.y));

    for(let i=0;i<player.optionSlots.length;i++){ const opt=player.optionSlots[i]; const tx=player.x+(i*20-((player.optionSlots.length-1)*10)); const ty=player.y-30; opt.x+=(tx-opt.x)*(5*dt); opt.y+=(ty-opt.y)*(5*dt); }

    player.shotCooldown-=dt;
    if(keys['z']||keys[' ']||keys['x']||touchShoot) if(player.shotCooldown<=0){ bullets.push({x:player.x+player.w/2-3,y:player.y-8,w:6,h:10,vy:-400}); player.shotCooldown=0.18; for(const opt of player.optionSlots){ bullets.push({x:opt.x,y:opt.y,w:5,h:8,vy:-400}); } }

    for(let i=bullets.length-1;i>=0;i--){ bullets[i].y+=bullets[i].vy*dt; if(bullets[i].y<0) bullets.splice(i,1); }
    for(let i=enemies.length-1;i>=0;i--){ const e=enemies[i]; e.y+=e.vy*dt; for(let j=bullets.length-1;j>=0;j--){ if(rectsOverlap(bullets[j],e)){ bullets.splice(j,1); e.hp--; if(e.hp<=0){ score+=20; explode(e.x,e.y,12); enemies.splice(i,1); if(Math.random()<0.3) spawnBell(e.x,e.y); break; } } } if(rectsOverlap(e,player)){ explode(player.x,player.y,15); enemies.splice(i,1); loseLife(); } }
    for(let i=enemyBullets.length-1;i>=0;i--){ enemyBullets[i].y+=enemyBullets[i].vy*dt; if(rectsOverlap(enemyBullets[i],player)){ enemyBullets.splice(i,1); explode(player.x,player.y,10); loseLife(); } }
    for(let i=pickups.length-1;i>=0;i--){ const p=pickups[i]; p.y+=p.vy*dt; if(rectsOverlap(p,player)){ if(p.bellType===0) score+=50; else if(p.bellType===1) player.spd*=1.2,setTimeout(()=>{player.spd/=1.2;},6000); else if(p.bellType===2) addOption(); else if(p.bellType===3) addPower(2); else if(p.bellType===4) player.shield=true; pickups.splice(i,1); } }
    for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; p.life-=dt; p.x+=p.vx*dt; p.y+=p.vy*dt; if(p.life<=0) particles.splice(i,1); }
    scoreEl.textContent=score; livesEl.textContent=lives;
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle='#7ef9ff'; ctx.fillRect(player.x,player.y,player.w,player.h);
    if(player.shield){ ctx.strokeStyle='#ffd86b'; ctx.beginPath(); ctx.arc(player.x+player.w/2,player.y+player.h/2,28,0,Math.PI*2); ctx.stroke(); }
    for(const opt of player.optionSlots){ ctx.fillStyle='#ffd86b'; ctx.fillRect(opt.x-6,opt.y-6,12,12); }
    ctx.fillStyle='#ffd86b'; for(const b of bullets){ ctx.fillRect(b.x,b.y,b.w,b.h); }
    ctx.fillStyle='#ff6b6b'; for(const e of enemies){ ctx.fillRect(e.x,e.y,e.w,e.h); }
    const colors=['#fff','#7ef9ff','#7aff7a','#ff8b6b','#ffd86b'];
    for(const p of pickups){ ctx.fillStyle=colors[p.bellType]; ctx.beginPath(); ctx.arc(p.x,p.y,9,0,Math.PI*2); ctx.fill(); }
  }

  let spawnTimer=0;
  function loop(t){ const now=t/1000; const dt=now-last; last=now; update(dt); spawnTimer+=dt; if(spawnTimer>3){ spawnTimer=0; enemies.push({x:Math.random()*(W-40),y:-20,w:36,h:20,vy:40,hp:2}); } draw(); requestAnimationFrame(loop); }

  const keys={}; window.addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true;}); window.addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false;});
  let touchShoot=false; document.getElementById('shootBtn').addEventListener('mousedown',()=>{touchShoot=true}); document.getElementById('shootBtn').addEventListener('mouseup',()=>{touchShoot=false});
  play.addEventListener('click',()=>{overlay.style.display='none';running=true;score=0;lives=3;player.optionSlots=[];player.shield=false;last=performance.now()/1000;requestAnimationFrame(loop);});
})();
</script>
</body>
</html>
